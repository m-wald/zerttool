<?php
use Zertifizierungstool\Model\User;
use Zertifizierungstool\Model\SchreibtPruefung;
$last_try = new SchreibtPruefung();
?>
<div class="container">
<table class="table table-hover">
	<tr>
	<th width="150">Name</th>
	<th width="100">Termin</th>
	<th>Cutscore</th>
	</tr>

	<?php 
	foreach ($pruefungen as $pruefung){ ?>
		<tr>
		<td><?=$pruefung->getName()?></td>
		<td><?=$pruefung->getTermin()?></td>
		<td><?=$pruefung->getCutscore() * 100?></td>
		
	<?php if (strtotime($pruefung->getTermin()) > time() && (User::currentUser()->istAdmin() || User::currentUser()->istZertifizierer())) {?>
		<td><a href="<?= $this->url('pruefung', ['action' => 'edit',   'id' => $pruefung->getId()])?>"><button type="button" class="btn btn-warning"><span class="glyphicon glyphicon-edit"></span></button></a></td>
		<td><a href="<?= $this->url('pruefung', ['action' => 'delete', 'id' => $pruefung->getId()])?>"><button type="button" class="btn btn-warning">Löschen</button></a></td>
		</tr>
			
	<?php
	} elseif (User::currentUser()->istAdmin() || User::currentUser()->istTeilnehmer()) {
	$last_try->loadLastTry($pruefung->getId());
		if ($last_try->getBestanden()) {
			echo '<td align="center"><span class="glyphicon glyphicon-ok"></span></td></tr>';
		} elseif (strtotime($pruefung->getTermin()) <= time()) { ?>
			<td><a href="<?= $this->url('pruefung', ['action' => 'take', 'id' => $pruefung->getId()])?>"><button type="button">Absolvieren</button></a></td>
			</tr>
	<?php 
		}}}?>
</table>
<br>

<?php if (User::currentUser()->istAdmin() || User::currentUser()->istZertifizierer()) {?>
		<a href="<?= $this->url('pruefung', ['action' => 'create', 'id' => $kursid])?>"><button type="button">Neue Pr&uuml;fung anlegen</button></a>
		<a href="http://132.231.36.205/kurs/changedata?kurs_id=<?=$kursid?>"><button type="button">Zur&uuml;ck zur Bearbeitung der Kursdaten</button></a>
<?php }?>

</div>
